function clamp(a,e,t){return a<e?e:a>t?t:a}function clone(a){let e=!1;if(void 0!==a)try{e=JSON.parse(JSON.stringify(a))}catch(a){}return e}function sanitizeInput(a){return"object"!=typeof(a=clone(a))&&(a={}),Object.keys(defaultParams).filter(a=>"iterations"!==a).forEach(e=>{"number"!=typeof a[e]||isNaN(a[e])?a[e]=defaultParams[e]:a[e]=clamp(a[e],0,100),a[e]=Math.round(a[e])}),("number"!=typeof a.iterations||isNaN(a.iterations)||a.iterations<=0)&&(a.iterations=defaultParams.iterations),a.iterations=Math.round(a.iterations),a}function imageToImageData(a){if(a instanceof HTMLImageElement){if(!a.naturalWidth||!a.naturalHeight||!1===a.complete)throw new Error("This this image hasn't finished loading: "+a.src);const e=new Canvas$1(a.naturalWidth,a.naturalHeight),t=e.getContext("2d");t.drawImage(a,0,0,e.width,e.height);const s=t.getImageData(0,0,e.width,e.height);return s.data&&s.data.length&&(void 0===s.width&&(s.width=a.naturalWidth),void 0===s.height&&(s.height=a.naturalHeight)),s}throw new Error("This object does not seem to be an image.")}function loadBase64Image(a){return new Promise((e,t)=>{const s=new Image$2;s.onload=(()=>{e(s)}),s.onerror=(a=>{t(a)}),s.src=a})}function base64URLToImage(a,e,t,s){loadBase64Image(a).then(t,s)}function getImageSize(a){return{width:a.width||a.naturalWidth,height:a.height||a.naturalHeight}}function canvasFromImage(a){const e=getImageSize(a),t=new Canvas$1(e.width,e.height),s=t.getContext("2d");return s.drawImage(a,0,0,e.width,e.height),{canvas:t,ctx:s}}function base64URLToImageData(a,e,t,s){loadBase64Image(a).then(a=>{const e=getImageSize(a),s=canvasFromImage(a).ctx.getImageData(0,0,e.width,e.height);s.width||(s.width=e.width),s.height||(s.height=e.height),t(s)},s)}function isImageData(a){return a&&"number"==typeof a.width&&"number"==typeof a.height&&a.data&&"number"==typeof a.data.length&&"object"==typeof a.data}function imageDataToBase64(a,e){return new Promise((t,s)=>{if(isImageData(a)){const s=new Canvas$1(a.width,a.height);s.getContext("2d").putImageData(a,0,0),t(s.toDataURL("image/jpeg",e/100))}else s(new Error("object is not valid imageData"))})}function glitch(a){function e(){const a=objectAssign({},d);return c||objectAssign(a,f),a}function t(){const a=objectAssign({},d);return u||objectAssign(a,p),a}function s(a){return a}function n(a,e,n){return c=(()=>new Promise((t,i)=>{if(n)a(e,t,i);else if(a===s)t(e);else try{t(a(e,t,i))}catch(a){i(a)}})),r()?o():t()}function i(a,t,n){return u=(e=>new Promise((i,r)=>{n?a(e,t,i,r):a===s?i(e):a(e,t).then(i,r)})),r()?o():e()}function r(){return c&&u}function o(){return new Promise((e,t)=>{c().then(e=>h(e,a),t).then(a=>{u(a).then(e,t)},t)})}function h(a,e){return new Promise((t,s)=>{imageDataToBase64(a,e.quality).then(t=>g(a,t,e),s).then(t,s)})}function g(a,e,t){return new Promise((s,n)=>{m.addEventListener("message",a=>{a.data&&a.data.base64URL?s(a.data.base64URL):n(a.data&&a.data.err?a.data.err:a)}),m.postMessage({params:t,base64URL:e,imageData:a,imageDataWidth:a.width,imageDataHeight:a.height})})}a=sanitizeInput(a);let c,u;const m=new Worker(URL.createObjectURL(new Blob(['function isImageData(a){return a&&"number"==typeof a.width&&"number"==typeof a.height&&a.data&&"number"==typeof a.data.length&&"object"==typeof a.data}function base64ToByteArray(a){const e=[];let s;for(var t=23,r=a.length;t<r;t++){const r=reversedBase64Map[a.charAt(t)];switch((t-23)%4){case 1:e.push(s<<2|r>>4);break;case 2:e.push((15&s)<<4|r>>2);break;case 3:e.push((3&s)<<6|r)}s=r}return e}function jpgHeaderLength(a){let e=417;for(var s=0,t=a.length;s<t;s++)if(255===a[s]&&218===a[s+1]){e=s+2;break}return e}function glitchByteArray(a,e,s,t){const r=jpgHeaderLength(a),i=a.length-r-4,n=s/100,p=e/100;for(var o=0;o<t;o++){const e=i/t*o|0;let s=e+((i/t*(o+1)|0)-e)*p|0;s>i&&(s=i),a[~~(r+s)]=~~(256*n)}return a}function byteArrayToBase64(a){const e=["data:image/jpeg;base64,"];let s,t;for(var r=0,i=a.length;r<i;r++){const i=a[r];switch(s=r%3){case 0:e.push(base64Map$1[i>>2]);break;case 1:e.push(base64Map$1[(3&t)<<4|i>>4]);break;case 2:e.push(base64Map$1[(15&t)<<2|i>>6]),e.push(base64Map$1[63&i])}t=i}return 0===s?(e.push(base64Map$1[(3&t)<<4]),e.push("==")):1===s&&(e.push(base64Map$1[(15&t)<<2]),e.push("=")),e.join("")}function glitchImageData(a,e,s){if(isImageData(a))return byteArrayToBase64(glitchByteArray(base64ToByteArray(e),s.seed,s.amount,s.iterations));throw new Error("glitchImageData: imageData seems to be corrupt.")}function fail(a){self.postMessage({err:a.message||a})}function success(a){self.postMessage({base64URL:a})}const base64Chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",base64Map=base64Chars.split(""),reversedBase64Map$1={};base64Map.forEach((a,e)=>{reversedBase64Map$1[a]=e});var maps={base64Map:base64Map,reversedBase64Map:reversedBase64Map$1};const reversedBase64Map=maps.reversedBase64Map,base64Map$1=maps.base64Map;onmessage=(a=>{const e=a.data.imageData,s=a.data.params,t=a.data.base64URL;if(e&&t&&s)try{void 0===e.width&&"number"==typeof a.data.imageDataWidth&&(e.width=a.data.imageDataWidth),void 0===e.height&&"number"==typeof a.data.imageDataHeight&&(e.height=a.data.imageDataHeight),success(glitchImageData(e,t,s))}catch(a){fail(a)}else fail(a.data.imageData?"Parameters are missing.":"ImageData is missing.");self.close()});'],{type:"text/javascript"}))),d={getParams:function(){return a},getInput:e,getOutput:t},f={fromImageData:function(a){return n(s,a)},fromImage:function(a){return n(imageToImageData,a)}},p={toImage:function(a){return i(base64URLToImage,a,!0)},toDataURL:function(a){return i(s)},toImageData:function(a){return i(base64URLToImageData,a,!0)}};return e()}var defaultParams={amount:35,iterations:20,quality:30,seed:25};class Canvas$1{constructor(a=300,e=150){this.canvasEl=document.createElement("canvas"),this.canvasEl.width=a,this.canvasEl.height=e,this.ctx=this.canvasEl.getContext("2d")}getContext(){return this.ctx}toDataURL(a,e,t){if("function"!=typeof t)return this.canvasEl.toDataURL(a,e);t(this.canvasEl.toDataURL(a,e))}get width(){return this.canvasEl.width}set width(a){this.canvasEl.width=a}get height(){return this.canvasEl.height}set height(a){this.canvasEl.height=a}}Canvas$1.Image=Image;const Image$2=Canvas$1.Image,base64Chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",base64Map=base64Chars.split("");base64Map.forEach((a,e)=>{});const objectAssign=Object.assign;export default glitch;